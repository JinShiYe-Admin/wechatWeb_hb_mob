<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>金视野教育</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/utils/pullToRefresh.css" />
		<style type="text/css">
			.mui-media {
				font-size: 14px;
			}
			
			.mui-table-view .mui-media-object {
				max-width: initial;
				width: 90px;
				height: 70px;
			}
			
			.meta-info {
				position: absolute;
				left: 115px;
				right: 15px;
				bottom: 8px;
				color: #8f8f94;
			}
			
			.meta-info .author,
			.meta-info .time {
				display: inline-block;
			}
			
			.meta-info .time {
				float: right;
			}
			
			.mui-table-view:before,
			.mui-table-view:after {
				height: 0;
			}
			
			.mui-content>.mui-table-view:first-child {
				margin-top: 1px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		</header>

		<div class="mui-content mui-scroll-wrapper" style="z-index: 1;" id="contacts">
			<div class="mui-scroll">
				<items :model='model' v-for='model in data'></items>
				<!--列表信息流 结束-->
			</div>
		</div>
		<template>
			<li>
				<div @click='toggle'>
					<i v-if='isFolder' class="fa " :class="[open?'fa-folder-open':'fa-folder']"></i>
					<!--isFolder判断是否存在子级改变图标-->
					<i v-if='!isFolder' class="fa fa-file-text"></i> {{model.data.menuName}}
				</div>
				<ul v-show="open" v-if='isFolder'>
					<items v-for='cel in model.childTreeNode' :model='cel'></items>
				</ul>
			</li>
		</template>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/utils/mui.pullToRefresh.js"></script>
		<script type="text/javascript" src="../../js/utils/mui.pullToRefresh.material.js"></script>
		<script type="text/javascript">
			document.write("<s" + "cript type='text/javascript' src='../../js/importJS.js?" + Math.random() + "'></s" + "cript>");
		</script>
		<script type="text/javascript">
			var data = [{
				"id": "1",
				"data": {
					"menuName": "项目管理",
					"menuCode": "",
				},
				"childTreeNode": [{
					"data": {
						"menuName": "项目",
						"menuCode": "BusProject",
					},
					"childTreeNode": []
				}, {
					"data": {
						"menuName": "我的任务",
						"menuCode": "BusProject",
					},
					"childTreeNode": []
				}, {
					"data": {
						"menuName": "人员周报",
						"menuCode": "BusProject",
					},
					"childTreeNode": []
				}]
			}, {
				"id": "2",
				"data": {
					"menuName": "数据统计",
					"menuCode": "BusClock",
				},
				"childTreeNode": []
			}, {
				"id": "3",
				"data": {
					"menuName": "人事管理",
					"menuCode": "",
				},
				"childTreeNode": []
			}, {
				"id": "4",
				"data": {
					"menuName": "基础管理",
					"menuCode": "",
				},
				"childTreeNode": []
			}]
			var contacts = new Vue({
				el: '#contacts',
				data: data

			});

			export default {
				name: 'items',
				props: ['model'],
				components: {},
				data() {
					return {
						open: false,
						isFolder: true
					}
				},
				computed: {
					isFolder: function() {
						return this.model.childTreeNode && this.model.childTreeNode.length
					}
				},
				methods: {
					toggle: function() {
						if(this.isFolder) {
							this.open = !this.open
						}
					},
				}
			}
		</script>
		<!--<nav id="alertBar" class="mui-bar mui-bar-tab" style="height: 60px;">
			<hr style="margin-top: -1px; height:1px;border:none;border-top:1px solid #ededed;" />
			<div align="center" style="margin-top: 5px;">
				<button id="alertAll" type="button" class="mui-btn mui-btn-blue mui-pull-right " style="border-radius: 2px;width: 20%;background-color: #00a5e0;border-color:#00a5e0 ;height: 30px;font-size:16px;letter-spacing: 1px;">确定</button>
			</div>
		</nav>-->

		<script type="text/javascript">
			//			mui.init();
			//			var vm_contacts = new Vue({
			//				el: '#contacts',
			//				data: {
			//					items: [] //列表信息流数据
			//				}
			//			});
			//			window.onload = function() {
			//				var detail = utils.getDataFromUrl(window.location.href);
			//				if(detail.id) {
			//					var data = {
			//						access_token: detail.access_token,
			//						department_id: detail.id,
			//					}
			//					console.log(JSON.stringify(data))
			//					jQuery.getJSON("https://qyapi.weixin.qq.com/cgi-bin/user/simplelist", data, function(rsp) {
			//						alert(JSON.stringify(rsp))
			//						console.log(JSON.stringify(rsp))
			//						vm_contacts.items = rsp.userlist
			//
			//					});
			//					return;
			//				}
			//				var data = {
			//					corpid: 'wx6c4528c675d4a9c9',
			//					corpsecret: 'K9TuOUac2CjcxsDQm40FiuTubSFWgYAx1v9HZyYfMRZ-P0LCBQmEUmfWUhjl9kY6'
			//				}
			//				jQuery.getJSON("https://qyapi.weixin.qq.com/cgi-bin/gettoken", data, function(rsp) {
			//					alert(JSON.stringify(rsp))
			//					vm_contacts.access_token = rsp.access_token;
			//					userdata = {
			//						access_token: rsp.access_token,
			//						id: ''
			//					}
			//					jQuery.getJSON("https://qyapi.weixin.qq.com/cgi-bin/department/list", userdata, function(rsp) {
			//						alert(JSON.stringify(rsp))
			//						vm_contacts.items = rsp.department
			//
			//					});
			//				});
			//			}

			//点击列表，打开详情
			//TODO 后续应该封装一个v-tap指令，实现tap监听
			mui('.mui-content').on('tap', '[data-id]', function() {
				var data = {
					id: this.getAttribute('data-id'),
					access_token: vm_contacts.access_token
				}
				if(vm_contacts.items[0].userid) {
					return;
				}
				utils.wOpenWithData("contacts.html", data);

			});

			function getDefaultData() {
				if(detail.deptId) {
					vm_contacts.items = [{
						contactId: 1,
						name: '宋艳明',
						imgurl: '../../image/utils/default_personalimage.png'
					}, {
						contactId: 2,
						name: '赵启旺',
						imgurl: '../../image/utils/default_personalimage.png'
					}, {
						contactId: 3,
						name: '安琪',
						imgurl: '../../image/utils/default_personalimage.png'
					}, {
						contactId: 4,
						name: '莫尚林',
						imgurl: '../../image/utils/default_personalimage.png'
					}]
				} else {
					vm_contacts.items = [{
						deptId: 1,
						name: '开发部',
						imgurl: '../../image/newsIndex.png'
					}, {
						deptId: 2,
						name: '财务部',
						imgurl: '../../image/newsIndex.png'
					}, {
						deptId: 3,
						name: '行政部',
						imgurl: '../../image/newsIndex.png'
					}, {
						deptId: 4,
						name: '支撑中心',
						imgurl: '../../image/newsIndex.png'
					}]
				}
			}
		</script>
	</body>

</html>