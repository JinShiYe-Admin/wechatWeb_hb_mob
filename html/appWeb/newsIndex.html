<!DOCTYPE html>
<html>

	<head>
		<title>jQuery WeUI</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

		<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

		<link rel="stylesheet" href="../../js/demoCssJs/weui.min.css">
		<link rel="stylesheet" href="../../js/demoCssJs/jquery-weui.css">
		<link rel="stylesheet" href="../../js/demoCssJs/demos.css"> 
		<style>
			.has-max {
				max-width: 640px;
			}
			
			.category_nav {
				white-space: nowrap;
			}
			
			.category_nav a {
				display: inline-block;
			}
			
			.category_nav li a {
				display: inline-block;
				padding: 0 .5rem;
			}
		</style>
	</head>

	<body ontouchstart>
		<div class="weui-tab" id="column">
			<div class="weui-navbar category_nav">
				<a class="weui-navbar__item" v-for="item in items" :href="'#tab'+item.chnid">{{item.cname}}</a>
			</div>
			<div class="weui-tab__bd">
				<!--<div :id="'tab'+item.chnid" class="weui-tab__bd-item infinite  weui-pull-to-refresh" v-for="newsModel in item.newsArray">
					<div class="weui-pull-to-refresh__layer">
						<div class='weui-pull-to-refresh__arrow'></div>
						<div class='weui-pull-to-refresh__preloader'></div>
						<div class="down">下拉刷新</div>
						<div class="up">释放刷新</div>
						<div class="refresh">正在刷新</div>
					</div>
					<h1>newsModel.topic</h1>
					<div class="content-padded">
						<p>Time: <span id="time">下拉我试试</span></p>
						<p>jQuery API - jQuery is a fast, small, and feature-rich JavaScript library.</p>
						<p>Lots of people use React as the V in MVC.</p>
					</div>
					<div class="weui-loadmore">
						<i class="weui-loading"></i>
						<span class="weui-loadmore__tips">正在加载</span>
					</div>
				</div>
			</div>-->
			<div :id="'tab'+item.chnid" class="weui-cells" v-for="item in items">
				<a class="weui-cell weui-cell_access" href="javascript:;" v-for="newsModel in item.newsArray">
					<div class="weui-cell__hd"><img src="../../image/icon_tabbar.png" alt="" style="width:20px;margin-right:5px;display:block"></div>
					<div class="weui-cell__bd">
						<p>{{newsModel.topic}}</p>
					</div>
				</a>
			</div>
			<div class="weui-tabbar">
				<a href="#" class="weui-tabbar__item weui-bar__item--on">
					<div class="weui-tabbar__icon">
						<img src="../../image/icon_tabbar.png" alt="">
					</div>
					<p class="weui-tabbar__label">新闻</p>
				</a>
				<a href="mineIndex.html" class="weui-tabbar__item">
					<div class="weui-tabbar__icon">
						<img src="../../image/icon_tabbar.png" alt="">
					</div>
					<p class="weui-tabbar__label">我的</p>
				</a>
			</div>
		</div>
		<script src="../../js/demoCssJs/jquery-2.1.4.js"></script>
		<script src="../../js/demoCssJs/iscroll.js"></script>
		<script src="../../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/demoCssJs/jquery-weui.js"></script>
		<script type="text/javascript">
			document.write("<s" + "cript type='text/javascript' src='../../js/importJS.js?" + Math.random() + "'></s" + "cript>");
		</script>
		<script>
			var columnData = new Vue({
				el: '#column',
				data: {
					items: [{
							active: true,
							chnid: 1,
							cname: '111',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 1, //文章ID
								chnid: 1, //栏目ID
								topic: '我的标题', //文章标题
								subtopic: '我是副标题', //文章副标题
								summas: '我是摘要', //摘要
								content: '我是正文', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}, {
								newsid: 2, //文章ID
								chnid: 1, //栏目ID
								topic: '我的标题2', //文章标题
								subtopic: '我是副标题2', //文章副标题
								summas: '我是摘要2', //摘要
								content: '我是正文2', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名2', //投稿者姓名
								rectime: '2017-07-11', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						},
						{
							active: false,
							chnid: 2,
							cname: '222',
							linkurl: '../../image/icon_tabbar.png',
							newsPage: 1, //获取新闻的页码
							newsFlag: 0, //0刷新，1加载更多
							newsArray: [{
								newsid: 3, //文章ID
								chnid: 2, //栏目ID
								topic: '我的标题3', //文章标题
								subtopic: '我是副标题3', //文章副标题
								summas: '我是摘要3', //摘要
								content: '我是正文3', //正文
								recuser: 2, //投稿者ID
								rectname: '投稿者姓名', //投稿者姓名
								rectime: '2017-07-12', //填写时间
								stat: 1, //状态
								clicked: 222, //点击率
								isquo: 1, //是否为引用
								quourl: 'www.baidu.com', //引用链接
								isreply: 1, //是否允许评论
								isenc: 1, //是否有附件
								imgurl: '../../image/icon_tabbar.png' //缩略图url
							}]
						}
					] //列表信息流数据
				},
				methods: {
					clickCulumn: function(model) {
						alert('model:' + JSON.stringify(model));
					}
				}
			});
			var all_width = document.getElementsByClassName('category_nav')[0].scrollWidth;
			$('.category_nav').css({
				'width': all_width * 2 + 'px'
			})
			var myscroll = new iScroll("column", {
				scrollX: true,
				scrollY: false,
				hScrollbar: false,
				vScrollbar: false,
				vScroll: false
			});

			var allheight = document.getElementsByClassName('weui-tab')[0].scrollHeight;
			var barheight = document.getElementsByClassName('weui-tabbar')[0].scrollHeight;
			$('.weui-tab__bd').css({
				'height': (allheight - barheight) * 100 / allheight + '%'
			});
			$('.weui-tab__bd-item').css({
				'height': (allheight - barheight) * 100 / allheight + '%'
			});
			window.addEventListener("resize", function() {
				var allheight = document.getElementsByClassName('weui-tab')[0].scrollHeight
				var barheight = document.getElementsByClassName('weui-tabbar')[0].scrollHeight
				$('.weui-tab__bd').css({
					'height': (allheight - barheight) * 100 / allheight + '%'
				});
				$('.weui-tab__bd-item').css({
					'height': (allheight - barheight) * 100 / allheight + '%'
				});
			}, false);
			$(".infinite").infinite(0).on("infinite", function() {
				var self = this;
				if(self.loading) return;
				$(self).find(".weui-loadmore").show();
				console.log(self)
				self.loading = true;
				console.log(self);
				setTimeout(function() {
//					$(self).find(".content-padded").append("<p>我是加载的新内容。我是加载的新内容我是加载的新内容我是加载的新内容我是加载的新内容我是加载的新内容我是加载的新内容</p>");
					$(self).find(".weui-loadmore").hide();
					self.loading = false;
				}, 100); //模拟延迟
			});
			$(".weui-pull-to-refresh").pullToRefresh().on("pull-to-refresh", function() {
				var self = this;
				if(self.loading) return;
				console.log(self)
				self.loading = true;
				console.log(self);
				setTimeout(function() {
//					$(self).find(".content-padded").append("<p>下拉刷新......下拉刷新......下拉刷新......下拉刷新......下拉刷新......下拉刷新......下拉刷新......</p>");
					self.loading = false;
					$(".weui-pull-to-refresh").pullToRefreshDone();
				}, 100); //模拟延迟
			});
			window.onload = function() {
				//获取所有的栏目
//				getSumColumn();
			};
			//获取所有的栏目
			function getSumColumn() {
				var tempData = {
					cmd: 'chn', //网站栏目
					type: 'findpage', //分页查找栏目列表
					pagesize: 999, //每页条数
					pageindex: 1 //页码
				}
				unitWebsitePro(tempData, function(data) {
					if(data.RspCode == 0) {
						if(data.RspData.dt.length > 0) {
							//塞入页码、加载状态等自定义参数
							for(var tempItem in data.RspData.dt) {
								data.RspData.dt[tempItem].newsPage = 1; //获取新闻的页码
								data.RspData.dt[tempItem].newsFlag = 0; //0刷新，1加载更多
								data.RspData.dt[tempItem].newsArray = []; //栏目对应的新闻列表
								if(tempItem == 0) {
									data.RspData.dt[tempItem].active = true;
								} else {
									data.RspData.dt[tempItem].active = false;
								}
							}
							columnData.items = data.RspData.dt;
							//获取索引为0的栏目新闻列表
							getNewsList(columnData.items[0]);
						} else {
							alert('暂时还没有栏目');
						}
					} else {
						alert(data.RspTxt);
					}
				});
			};
			//获取栏目对应的新闻
			function getNewsList(columnModel) {
				var tempData = {
					cmd: 'news', //文章管理
					type: 'findpage', //分页查找文章列表
					pagesize: '10', //每页条数
					pageindex: columnModel.newsPage, //页码
					chnid: columnModel.chnid //某个栏目下的文章，栏目id
				}
				unitWebsitePro(tempData, function(data) {
					if(data.RspCode == 0) {
						if(data.RspData.dt.length > 0) {
							//							alert('获取到的新闻：' + JSON.stringify(data.RspData.dt));
							//判断是刷新0，还是加载更多1
							if(columnModel.newsFlag == 0) {
								columnModel.newsArray = data.RspData.dt;
							} else {
								jQuery.merge(columnModel.newsArray, data.RspData.dt); //合并数组
							}
						}
						columnModel.newsPage++;
						//						alert('最终的数据为：' + JSON.stringify(columnData.items));
					} else {
						alert(data.RspTxt);
					}
				});
			}
		</script>
	</body>
</html>