<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>

		<link rel="stylesheet" type="text/css" href="../../js/H-ui.admin/static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../js/H-ui.admin/static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="../../js/H-ui.admin/lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../js/H-ui.admin/static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="../../js/H-ui.admin/static/h-ui.admin/css/style.css" />
		<style>
 	</style>
	</head>
	
    
	<body>
		<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 新闻 <span class="c-gray en">&gt;</span> 新闻审核
			<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a>
		</nav>
		<div class="page-container">
			<div id="chnid">
				<select class="select" id="Prixlk" name="one" style="height: 45px;font-size: 17px;color: #929292;">
					<option id="selectDropdown" :value='item.chnid' v-for="item in items">{{item.cname}}</option>
				</select>
			</div>
			<div id="newsData">

				<table style=" table-layout:fixed;" class="table table-border table-bordered table-bg table-hover table-sort table-responsive">
					<thead>
						<tr class="text-c"> 
							<th width="90"  >新闻标题</th>
							<th width="90" >新闻副标题</th>
							<th width="120" >新闻内容</th> 
							<th  width="100" >操作</th>
						</tr>
					</thead>
					<tbody>
						<tr class="text-c" v-for="(newsModel,index) in item.newsArray" :data-index="index">

							 
							<td  style="  overflow:hidden;white-space:nowrap;text-overflow:ellipsis;" > {{newsModel.topic}}</td>
							<td style="overflow:hidden;white-space:nowrap;text-overflow:ellipsis;" >{{newsModel.subtopic}}</td>
							<td  style="overflow:hidden;white-space:nowrap;text-overflow:ellipsis;" >{{newsModel.content}}</td>
							 
							<td   style="text-align: center;">
								<button id="{{newsModel.newsid}}" class="btn btn-primary radius" @click="clickDel(newsModel,1,index)">{{newsModel.Prizt}}</button>&nbsp;&nbsp;&nbsp;
								<button class="btn btn-secondary radius" @click="click(newsModel,index,item.cname )">编辑</button>&nbsp;&nbsp;&nbsp;
								<button class="btn btn-danger radius" @click="clickDel(newsModel,0,index)">删除</button>&nbsp;&nbsp;&nbsp;
							</td>
						</tr>

					</tbody>
				</table>
			</div>
		</div>
		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="../../js/H-ui.admin/lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/H-ui.admin/lib/layer/2.4/layer.js"></script>
		<!--<script type="text/javascript" src="../../js/H-ui.admin/static/h-ui/js/H-ui.min.js"></script>-->
		<!--<script type="text/javascript" src="../../js/H-ui.admin/static/h-ui.admin/js/H-ui.admin.js"></script>-->
		<script src="../../js/demoCssJs/jquery-2.1.4.js"></script>
		<script src="../../js/demoCssJs/iscroll.js"></script>
		<script src="../../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/demoCssJs/jquery-weui.js"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<!--<script src="../../js/lib/WdatePicker.js" ></script>-->
		<script type="text/javascript">
			document.write("<s" + "cript type='text/javascript' src='../../js/importJS.js?" + Math.random() + "'></s" + "cript>");
		</script>
		<!--/_footer 作为公共模版分离出去-->

		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="../../js/H-ui.admin/lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script>
		<script type="text/javascript">
	        function click(newsModel, index, cname) {  
				var newslist = new Object(); 
                newslist.cname = cname; 
                newslist.type = "edit"; 
                newslist.newsid = newsModel.newsid;   
				utils.wOpenWithData("../pcWeb-HUI/Test.html", newslist);  
			}
			var newsFlag = 0; //0刷新，1加载更多
			var newsPage = 1; //加载当当前新闻的页码
			//所属栏目下拉框
			var vue_input = new Vue({
				el: '#chnid',
				data: {
					items: [ 
					]
				},
				methods: {}
			});
			//新闻数据列表
			var newsData = new Vue({
				el: '#newsData',
				data: {
					item: {
						newsArray: [ 
						{
						newsid:102,
						corpid:"wx6c4528c675d4a9c9",
						chnid:5,
						topic:"学校和市审计局启动战略合作",
						subtopic:"来源：成都大学新闻网",
						summas:"111",
						content:"<section><h3></h3><p>本网消息（文/李科 图/潇潇）9月27日上午，成都市审计局与成都大学政校合作战略框架协议签字暨成都市审计学会授牌仪式在学术会议室举行。校长王清远、市审计局局长曾军出席仪式并致辞。党委副书记、纪委书记易贤文主持签字授牌仪式。</p><p><img src=http://qn-cspb.jiaobaowang.net/wechat/webcon/1506580422165139.png></p></section><section><h3></h3><p>王清远在致辞中说，当前学校正按照市委市政府提出的“高水平办好成都大学”的总体要求，努力建设高水平应用型综合大学，培养高素质应用型人才，学校教学科研、服务地方、校城融合、协同育人等方面工作不断取得突出进展，办学实力显著增强，呈现出良好发展势头。他表示，希望以此为契机，全面加强与市审???局的全方位、深度合作，发挥综合性大学多学科优势，做好成都市审计学会工作，共同为地方审计业务工作、审计人才培养、审计事业发展贡献更大力量。</p><p><img src=http://qn-cspb.jiaobaowang.net/wechat/webcon/1506580446369615.png></p></section><section><h3></h3><p>曾军说，近年来，国家十分重视审计事业发展，对审计工作的要求越来越高，审计事业迎来新机遇和新挑战，为政校合作创造了空间，此次政校合作协议签订是成都审计事业发展中的一件大事。他表示，地方需要大量交叉型、复合型专业审计人才，成都大学有丰富科研资源和雄厚科研力量，有优秀教育培训专家，双方整合资源，深化合作，积极作为，将为学校审计人才培养，地方审计事业发展作出贡献，为国家中心城市建设舔砖加瓦。</p><p><img src=http://qn-cspb.jiaobaowang.net/wechat/webcon/1506580469701259.png></p></section><section><h3></h3><p>签??及挂牌仪式结束后，召开了成都市审计学会新一届会员代表大会。成都市审计局副局长李永平，副校长彭晓琳，以及双方相关职能部门负责人和成都市各区（市）、县审计局负责人参加相关活动。</p><p><img src=http://qn-cspb.jiaobaowang.net/wechat/webcon/1506580480781460.png></p></section>",
						recuser:"liuyang",
						rectname:"刘洋",
						rectime:"2017-09-28T14:35:06.12",
						recip:"120.192.29.16",
						stat:1,
						clicked:5,
						isquo:1,
						quourl:"on",
						isreply:1,
					 
						imgurl:"http://qn-cspb.jiaobaowang.net/wechat/webcon/1506580422165139.png?imageView2/3/w/100/h/100/q/100/format/png",
						 
						Prizt:"不通过"
						}
						]
					}
				},
				updated: function() {
					var tempVVV = document.getElementById("newsData");
					console.log('tempVVV:' + tempVVV.innerHTML);
				},
				methods: {
					clickDel: function(model, Pribs, index) {
						var colid = model.newsid; //新闻id
						//确认框confirm	  
						if(Pribs == 0) {
							layer.confirm("确定要删除吗？", function(index) { 
								layer.close(index); 
								//确定删除
								var tempData = {
									cmd: 'news', //文章管理
									type: 'del', //分页查找文章列表
									colid: colid
								}
								unitWebsitePro(tempData, function(data) {
									console.log(JSON.stringify(data));
									if(data.RspCode == 0000) {
										if(newsData.item.newsArray[index].newsid == colid) {
											newsData.item.newsArray.splice(index, 1);
											layer.msg('已删除!', {
										    icon: 1,
										    time: 1000
									});
										}
									}
								});
							}, function() {});
						} else if(Pribs == 1) {
							SetStat(model, colid);
						}
					}
				}
			});
						//修改审核状态
			function SetStat(model, colid) {	
				var stat = "";
				if(model.stat == 0)
					stat = 1;
				if(model.stat == 1)
					stat = 0;
				var tempData = {
					cmd: 'news', //文章管理
					type: 'edit',
					callcol: 'chk',
					colid: colid,
					colv: stat //状态
				} 
				unitWebsitePro(tempData, function(data) {
					console.log(JSON.stringify(data));
					if(data.RspCode == 0000 && stat == 1) {
						model.Prizt = '不通过';
						model.stat = 1;
					} else if(data.RspCode == 0000 && stat == 0) {
						model.Prizt = '通过';
						model.stat = 0;
					}
				})

			}
			window.onload = function() {
				var tempData = {
					cmd: 'chn', //网站栏目
					type: 'findpage', //分页查找栏目列表 
					pagesize: 999, //每页条数 
					iswrite: '1',
					stat: '1',
					pageindex: 1 //页码  
				}
				unitWebsitePro(tempData, function(data) {
					//塞入页码、加载状态等自定义参数 
					for(var tempItem in data.RspData.dt) {
						data.RspData.dt[tempItem].newsPage = 1; //获取新闻的页码
						data.RspData.dt[tempItem].newsFlag = 0; //0刷新，1加载更多
						data.RspData.dt[tempItem].newsArray = []; //栏目对应的新闻列表
						if(tempItem == 0) {
							data.RspData.dt[tempItem].active = true;
						} else {
							data.RspData.dt[tempItem].active = false;
						}
					}
					if(data.RspCode == 0) {
						if(data.RspData.dt.length > 0) {
							newsData.item = data.RspData.dt[0];
							vue_input.items = data.RspData.dt;
							getNewsList(newsData.item);
						} else {
							alert('暂时还没有栏目');
						}
					} else {
						alert(data.RspTxt);
					}
				});

			}
			$("#Prixlk").change(function() {
				var Chnid = document.getElementById("Prixlk");
				var PriChnid = Chnid.selectedIndex; // 选中索引
				console.log(PriChnid);
				newsData.item = vue_input.items[PriChnid];
				newsData.item.newsPage = 1; //获取新闻的页码
				newsData.item.newsFlag = 0; //0刷新，1加载更多
				newsData.item.newsArray = []; //栏目对应的新闻列表
				getNewsList(newsData.item);

			})
			//获取栏目对应的新闻
			function getNewsList(columnModel) {
				console.log('获取新闻列表');
				var tempData = {
					cmd: 'news', //文章管理
					type: 'findpage', //分页查找文章列表
					pagesize: '15', //每页条数
					pageindex: columnModel.newsPage, //页码
					chnid: columnModel.chnid //某个栏目下的文章，栏目id
				}
				//				//alert(columnModel.chnid);
				unitWebsitePro(tempData, function(data) {
					if(data.RspCode == 0) {
						if(data.RspData.dt.length > 0) {
							columnModel.newsPage++;
							console.log('columnModel.newsFlag:' + columnModel.newsFlag);
							//循环审核状态
							for(var i = 0; i < data.RspData.dt.length; i++) {
								var tempModel = data.RspData.dt[i];
								if(tempModel.stat == 1)
									//data.RspData.dt[i]["stat"]=Prizt = "是"; 
									tempModel.Prizt = "不通过";
								if(tempModel.stat == 0)
									//data.RspData.dt[i]["stat"]=Prizt = "否"; 
									tempModel.Prizt = "通过";
							}
							//判断是刷新0，还是加载更多1
							if(columnModel.newsFlag == 0) {
								columnModel.newsArray = [].concat(data.RspData.dt);
							} else {
								newsData.item.newsArray = newsData.item.newsArray.concat(data.RspData.dt);
							}
							setTimeout(function() {
								$(".weui-loadmore").hide();
								loading = false;
								$(".weui-pull-to-refresh").pullToRefreshDone();
								delNoMore();
								if(data.RspData.dt.length < 15) {
									$(".content-padded").append('<p id="noMore" style="text-align: center;color: darkgray;">--------暂无更多数据--------</p>');
								}
							}, 1000); //模拟延迟
						} else {
							setTimeout(function() {
								$(".weui-loadmore").hide();
								loading = false;
								$(".weui-pull-to-refresh").pullToRefreshDone();
							}, 1000); //模拟延迟
							delNoMore();
							$(".content-padded").append('<p id="noMore" style="text-align: center;color: darkgray;">--------暂无更多数据--------</p>');
						}
						console.log('最终数据:' + JSON.stringify(newsData.item));
					} else {
						alert(data.RspTxt);
					}
				});
			}
		</script>
	</body>

</html>