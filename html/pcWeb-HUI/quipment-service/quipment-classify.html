<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<!--	<meta name="viewport" content="width=device-width initial-scale=1 minimum-scale=1 maximum-scale=1 user-scalable=no">-->
		<title></title>
		<link href="../../../css/jquery-weui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../../js/H-ui.admin/static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../../js/H-ui.admin/static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="../../../js/H-ui.admin/lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../../js/H-ui.admin/static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="../../../js/H-ui.admin/static/h-ui.admin/css/style.css" />
		<style>
			.float-right {
				float: right;
				margin-left: 10px;
			}
			
			.inline-block {
				display: inline-block;
			}
			
			body {
				background-color: #F8F8F8;
			}
			
			.title-persons {
				width: 80%;
			}
			
			.add-perdson,
			.del-classify,
			.show-classify {
				color: dodgerblue;
			}
			
			.close-classify {
				color: darkgray
			}
			
			.del-classify {
				padding-right: 15px;
			}
			
			.choose-footer {
				position: fixed;
				bottom: 0;
				left: 0;
				right: 0;
			}
			
			.selected-style {
				background-color: darkgrey;
				color: white;
			}
			
			.display-inline {
				/*display: inline-block;*/
			}
			
			.multi-choose-container {
				position: relative;
			}
			
			.choose-depart-container {
				position: absolute;
				left: 20%;
				top: 10%;
				width: 20%;
				height: 600px;
				overflow: auto;
			}
			
			.choose-person-container {
				position: absolute;
				left: 40%;
				top: 10%;
				right: 10%;
				width: 40%;
				height: 600px;
			}
			
			.choose-person {
				height: 500px;
				overflow: auto;
			}
			
			.check-container {
				width: 20%;
			}
			
			.name-contianer,
			.position-contianer {
				width: 40%;
			}
			
			.person-foot {
				padding-top: 10px;
			}
			
			.person-container {
				display: inline-block;
				padding: 5px 10px;
				text-align: center;
				border: solid 1px #D3D4D3;
				width: 50px;
				margin: 5px;
			}
			
			.person-container.is-checked {
				border-color: dodgerblue;
			}
			
			.btn-primary:disabled {
				background-color: darkgray;
				border: none;
			}
		</style>
	</head>

	<body>
		<div id="classify-container">
			<router-view v-on:group-info="getCurGroup" v-bind:classify="curGroup"></router-view>
		</div>
		<!--人员选择-->
		<template id="multi-choose">
			<div class="multi-choose-container">
				<div class="choose-depart-container">
					<choose-depart v-on:active-depart="getActiveDepart" class="display-inline choose-depart"></choose-depart>
				</div>
				<div class="choose-person-container">
					<p>人员选择</p>
					<div class="choose-person">
						<choose-person v-bind:chose-depart="activeDepart" v-bind:choose-person="selectPerson" v-on:select-person="getSelectPerson"></choose-person>
					</div>
					<div class="person-foot">
						<div v-if="Object.keys(selectPerson).length>0">
							<p>已选人员</p>
							<div v-for="key of Object.keys(selectPerson)" v-if="key" class="person-container is-checked" v-on:click="delChoosePerson(key)">
								{{selectPerson[key]}}
							</div>
						</div>
						<a v-if="Object.keys(selectPerson).length>0" class="btn btn-primary radius float-right" v-on:click="choosePerson()">添加人员</a>
						<a class="btn btn-default radius float-right" v-on:click="cancelChoose()">取消</a>
					</div>
				</div>
			</div>
		</template>
		<!--人员选择-->
		<template id="person-list">
			<div>
				<div v-for="(person,index) in personList" class="person-container" v-bind:class="[{'is-checked':person.isCheck}]" v-on:click="toggleChoosePerson(person,index)">
					{{person.name}}
				</div>
			</div>
		</template>
		<!--部门选择-->
		<template id="choose-depart">
			<div>
				<ul v-for="depart in rootDeparts">
					<depart-tree-node v-bind:depart-info="depart" v-bind:active-depart="activeDepart" v-on:active-depart="getActiveDepart"></depart-tree-node>
				</ul>
			</div>
		</template>
		<!--维修列表-->
		<template id="classify-list">
			<div>
				<div>
					<p class="inline-block">维修组列表</p>
					<span class="float-right">
					<a id="addressAdd" class="btn btn-primary radius" v-on:click="addService()"><i class="Hui-iconfont"></i> 添加维修组</a>
				</span>
				</div>
				<ul id="list" class="Huifold">
					<li v-for="(classify,index) in classifyList" class="item">
						<h4 v-on:click="classify.isShow=!classify.isShow">{{classify.cname}}
							<span class="Hui-iconfont Hui-iconfont-edit" v-on:click.stop="changeGroupName(classify)"></span>
							<span class="add-perdson float-right" v-on:click.stop="changePerson(classify)">更改人员</span>
							<!--<span class="Hui-iconfont Hui-iconfont-del3 del-classify float-right" v-on:click.stop="delClassify(classify,index)"></span>-->
							<span class="Hui-iconfont  float-right" v-bind:class="[{'Hui-iconfont-yanjing':classify.stat}, {'Hui-iconfont-niming':!classify.stat},{'close-classify':!classify.stat},{'show-classify':classify.stat}]" 
								v-on:click.stop="changeState(classify,index)"></span>
							<b v-bind:class="['Hui-iconfont',{'Hui-iconfont-arrow2-top':!classify.isShow},{'Hui-iconfont-arrow2-bottom':classify.isShow}]"></b>
						</h4>
						<template v-if="Object.keys(classify.gusers).length>0">
							<div v-show="classify.isShow" class="info">
								<div v-for="key in Object.keys(classify.gusers)" v-if="key" class="person-container">
									{{classify.gusers[key]}}
								</div>
							</div>
						</template>
					</li>
				</ul>
				<div id="modal-demo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content radius">
							<div class="modal-header">
								<h3 class="modal-title">组名</h3>
								<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
							</div>
							<div class="modal-body">
								<textarea type="text" class="textarea radius" v-model.trim="serviceGroupName" placeholder="请输入维修组名称"></textarea>
							</div>
							<div class="modal-footer">
								<button class="btn btn-primary" v-bind:disabled="serviceGroupName.length==0" v-on:click="changeClick()">确定</button>
								<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</template>
		<script src="../../../js/vue.js"></script>
		<script src="../../../js/vue-router.js"></script>
		<script src="../../../js/H-ui.admin/lib/jquery/1.9.1/jquery.min.js"></script>
		<script src="../../../js/H-ui.admin/static/h-ui/js/H-ui.js"></script>
		<!--<script src="../../../js/H-ui.admin/static/h-ui/js/jQuery.Huifold.js"></script>-->
		<script src="../../../js/utils/events.js"></script>
		<script src="../../../js/utils/consts.js"></script>
		<script src="../../../js/utils/request.js"></script>
		<script src="../../../js/equipment-service/classify-list.js"></script>
		<script src="../../../js/equipment-service/treeNode.js"></script>
		<script src="../../../js/equipment-service/choose-depart.js"></script>
		<script src="../../../js/equipment-service/choose-person.js"></script>
		<script>
			const classifyList = {
				template: '<classify-list v-on:group-info="getGroupInfo"></classify-list>',
				methods: {
					getGroupInfo: function(classify) {
						console.log("获取的classify:" + JSON.stringify(classify));
						this.$emit("group-info", classify)
					}
				}
			}
			const multiChoose = {
				template: '#multi-choose',
				props: ['classify'],
				data: function() {
					return {
						activeDepart: {},
						selectPerson: this.classify.gusers
					}
				},
				watch: {
					selectPerson: function(newVal, oldVal) {
						console.log("selectPerson.newVal:" + JSON.stringify(newVal));
						console.log("SelectPerson.oldVal:" + JSON.stringify(oldVal));
						console.log(Object.keys(newVal).length);
					},
					classify: function(newVal, oldVal) {
						console.log("wacth:监听classify:" + JSON.stringify(newVal))
						this.selectPerson = this.classify.gusers;
					}
				},
				methods: {
					getActiveDepart: function(activeDepart) {
						console.log("*******getActiveDepart*******")
						this.activeDepart = activeDepart;
						console.log("获取的响应的depart:" + JSON.stringify(activeDepart))
					},
					getSelectPerson: function(person) {
						console.log("*******getSelectPerson*******")
						this.selectPerson = Object.assign({}, person);
						console.log("getSelectPerson:" + JSON.stringify(this.selectPerson))
					},
					delChoosePerson: function(key) {
						console.log("*******delChoosePerson*******")
						delete this.selectPerson[key];
						this.selectPerson = Object.assign({}, this.selectPerson);
					},
					choosePerson: function() {
						console.log("*******choosePerson*******")
						request.editSeviceGroup({
							colid: this.classify.kindsid,
							callcol: "gusers",
							colv: this.personToString(this.selectPerson)
						}, function(response) {
							if(response.RspCode == 0) {
								router.go(-1);
							}
						})

					},
					personToString: function(person) {
						console.log("*******personToString*******")
						var strArr = [];
						for(var key in person) {
							strArr.push(key + "," + person[key]);
						}
						return strArr.join("|");
					},
					cancelChoose: function() {
						router.go(-1);
					}

				}
			}
			const router = new VueRouter({
				routes: [{
					path: '/classify-list',
					name: 'classify-list',
					component: classifyList
				}, {
					path: '/chooseDepart',
					name: 'chooseDepart',
					component: multiChoose
				}]
			})
			var vue = new Vue({
				el: "#classify-container",
				router: router,
				data: {
					curGroup: {

					}

				},
				mounted: function() {

				},
				methods: {
					getCurGroup: function(cgroup) {
						this.curGroup = cgroup;
					}
				}
			})
			router.replace({
				name: 'classify-list'
			})
		</script>
	</body>

</html>