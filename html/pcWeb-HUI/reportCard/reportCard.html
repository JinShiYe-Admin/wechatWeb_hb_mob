<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-stat-bar-style" content="black">
		<title>成绩单</title>
		<script type="text/javascript">
			var WebVersion = "?" + Math.random();
			document.write('<link rel="stylesheet" href="../../../js/H-ui.admin/static/h-ui/css/H-ui.min.css' + WebVersion + '" />');
			document.write('<link rel="stylesheet" href="../../../js/H-ui.admin/static/h-ui.admin/css/H-ui.admin.css' + WebVersion + '" />');
			document.write('<link rel="stylesheet" href="../../../js/H-ui.admin/lib/Hui-iconfont/1.0.8/iconfont.css' + WebVersion + '" />');
			document.write('<link rel="stylesheet" href="../../../js/H-ui.admin/static/h-ui.admin/skin/default/skin.css' + WebVersion + '" id="skin" />');
			document.write('<link rel="stylesheet" href="../../../js/H-ui.admin/static/h-ui.admin/css/style.css' + WebVersion + '" />');
		</script>
		<link rel="stylesheet" href="../../../js/demoCssJs/weui.min.css">
		<link rel="stylesheet" href="../../../js/demoCssJs/jquery-weui.css">
		<link rel="stylesheet" href="../../../js/demoCssJs/demos.css">
		<link rel="stylesheet" href="../../../css/demos.css" />
		<style>
			.operate-edit {
				text-decoration: none;
			}
			
			#column_info .row {
				margin-left: 0;
				margin-right: 0;
			}
			
			#column_info .submit-button {
				margin-bottom: 15px;
			}
			
			#column_info .input-text[type="number"] {
				width: 100%;
			}
		</style>
	</head>

	<body>
		<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 成绩单 <span class="c-gray en">&gt;</span>成绩单
			<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a>
		</nav>
		<div id="column_table" class="page-container">

			<div class="cl pd-5 bg-1 bk-gray">
				<span class="l">
					<a class="btn btn-primary radius" @click="add"><i class="Hui-iconfont"></i> 添加成绩单</a>
				</span>
				<!--<span class="select-box inline">
					<select id="stateSelect" class="select" title="选择部门">
						<option value="-1">开发部</option>
						<option value="0">行政部</option>
						<option value="1">财务部</option>
					</select>
				</span>
				<span class="select-box inline">
					<select id="stateSelect" class="select" title="选择成绩单名称">
						<option value="-1">开发部成绩单</option>
						<option value="0">行政部成绩单</option>
						<option value="1">财务部成绩单</option>
					</select>
				</span>-->
			</div>
			<div class="weui-cell">
				<div class="weui-cell__hd"><label class="weui-label">部门</label></div>
				<div class="weui-cell__bd">
					<input id="depart" data_id="" onclick="selectDepart(this)" class="weui-input" placeholder="请选择部门">
				</div>
			</div>
			<div class="weui-cell">
				<div class="weui-cell__hd"><label class="weui-label">成绩单名称</label></div>
				<div class="weui-cell__bd">
					<input id="cname" data_id="" class="weui-input" placeholder="请输入名称">
				</div>
			</div>
			<div class="weui-btn-area" style="width: 100px;">
				<button onclick="query()" id="submit" class="weui-btn weui-btn_primary">查询</button>
			</div>
			<table class="table table-border table-bordered table-bg">
				<thead class="text-c">
					<tr>
						<th>成绩单名称</th>
						<th>部门名称</th>
						<th>记录者</th>
						<th>记录时间</th>
						<th>操作</th>

					</tr>
				</thead>
				<tbody>
					<tr class="text-c" v-for="(item,index) in dt">
						<td>{{item.cname}}</td>
						<td>{{item.dptname}}</td>
						<td>{{item.recname}}</td>
						<td>{{item.rectime.replace("T"," ")}}</td>
						<td class="sorting_1">
							<a class="operate-edit" @click="clickEdit(item)" title="浏览"><i class="Hui-iconfont"></i></a>
							<a style="text-decoration:none" class="ml-5" @click="clickDel(item)" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a>

						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="pages" style="margin-top: 20px;"></div>
		</div>
		<script src="../../../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/demoCssJs/jquery-2.1.4.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/demoCssJs/iscroll.js"></script>
		<script src="../../../js/demoCssJs/jquery-weui.js"></script>
		<script src="../../../js/weui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/PublicProtocol.js"></script>
		<script src="../../../js/utils/utils.js"></script>
		<script src="../../../js/utils/storageutil.js"></script>
		<script src='../../../js/lib/vconsole/vconsole.min.js'></script>
		<script src="https://jsypay.jiaobaowang.net/wxthadmin/js/weui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src='https://jsypay.jiaobaowang.net/wxthadmin/js/demoCssJs/vue.min.js'></script>
		<script src='https://jsypay.jiaobaowang.net/wxthadmin/js/PublicProtocol.js'></script>
		<script src='https://jsypay.jiaobaowang.net/wxthadmin/js/utils/utils.js'></script>
		<script src='https://jsypay.jiaobaowang.net/wxthadmin/js/utils/storageutil.js'></script>

		<script src="../../../js/appweb/choose-file.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/utils/consts.js"></script>
		<script src="../../../js/utils/events.js"></script>
		<!--<script src="../../../js/compress.js"></script>-->
		<script type="text/javascript">
			document.write("<s" + "cript type='text/javascript' src='../../../js/PublicProtocol.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/utils/utils.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/utils/storageutil.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/H-ui.admin/lib/jquery/1.9.1/jquery.min.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/H-ui.admin/lib/layer/2.4/layer.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/H-ui.admin/static/h-ui/js/H-ui.min.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/H-ui.admin/static/h-ui.admin/js/H-ui.admin.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/H-ui.admin/lib/laypage/1.2/laypage.js" + WebVersion + "'></s" + "cript>");
			document.write("<s" + "cript type='text/javascript' src='../../../js/vue.min.js" + WebVersion + "'></s" + "cript>");
		</script>
		<script>
			//栏目表
			var column_table = new Vue({
				el: "#column_table",
				data: {
					depart_array: [],
					dt: [{
						departname: "开发部",
						reportname: "开发部成绩单",
						time: "2017/12/6"
					}]
				},
				updated: function() {

				},
				methods: {
					/**
					 * 点击添加栏目
					 */
					add: function() {

						var tempData = {
							type: 'add'
						}
						var url = "addReportCard.html";
						var ids = url.split("/");
						var dataStr = JSON.stringify(tempData);
						var index = layer.open({
							type: 2,
							title: "添加成绩单",
							content: url + "?v=" + Math.random() + "&data=" + encodeURIComponent(dataStr),
							end: function() {
								console.log("刷新")
								location.reload();
							}
						});
						layer.full(index);

						//						column_info.showAdd();

					},

					clickDel: function(item) { //删除栏目
						layer.confirm('删除后无法恢复,确认要删除吗？', function(index) {
							layer.close(index);
							var para = {
								cmd: 'examadmin',
								type: 'del',
								colid: item.examid
							}
							//							alert(JSON.stringify(para))
							unitWebsitePro(para, function(data) {
								if(data.RspCode == 0) {
									layer.msg('已删除!', {
										icon: 1,
										time: 1000
									});
									location.reload();
								} else {
									alert(data.RspTxt);
								}
							});
						});

					},
					clickEdit: function(item) {
						var url = "reportCardDetaill.html";
						var ids = url.split("/");
						var dataStr = JSON.stringify(item);
						console.log(dataStr)
						var index = layer.open({
							type: 2,
							title: "成绩单详情",
							content: url + "?v=" + Math.random() + "&data=" + encodeURIComponent(dataStr),
							end: function() {
								console.log("刷新")
								location.reload();
							}
						});
						layer.full(index);

						//						column_info.showEdit(this.dt[index]);
					},
				}
			});
			column_table.dt = [{
				cname: "开发部成绩单",
				dptname: "开发部",
				recname: "宋艳明",
				rectime: "2017/12/6T14:00"
			}];

			window.onload = function() {
				getDepart()
//				getexam(1);

			}

			function query() {
				getexam(1);
			}

			function getDepart() {

				var tempData = {
					cmd: 'persondeparts',
					type: 'findpage',
				}
				unitWebsitePro(tempData, function(data) {
					console.log('部门:' + JSON.stringify(data));
					var rspData = JSON.parse(data.RspData);
					if(data.RspCode == 0) {
						column_table.depart_array = [];
						for(var i = 0; i < rspData.length; i++) {
							var model = rspData[i];
							if(model.value == -1) {
								model.label = model.title;
								column_table.depart_array.push(model);
							} else {
								model.label = model.title;
								column_table.depart_array.push(model);
							}
						}
						console.log('重组部门:' + JSON.stringify(column_table.depart_array));

					} else {
						alert(data.RspTxt)
					}
				})

			}

			/**
			 * 获取成绩单列表
			 * @param {Object} pageindex 列表序号
			 */
			function getexam(pageindex) {
//				if(document.getElementById("depart").data_id==-1){
//					document.getElementById("depart").data_id = "";
//				}
				var tempData = {
					cmd: 'examadmin',
					type: 'findpage',
					cname: document.getElementById("cname").value,
					dptid: document.getElementById("depart").data_id,
					pagesize: '10',
					pageindex: pageindex
				}
				console.log("查询参数：" + JSON.stringify(tempData));
				unitWebsitePro(tempData, function(data) {
					console.log("成绩单" + JSON.stringify(data));
					if(data.RspCode == 0) {
						column_table.dt = data.RspData.dt;
						initLaypage(data.RspData.pg.PageCount, pageindex);
					} else {
						column_table.dt = [];
					}
				});
			}

			function selectDepart(input_item) {
				document.activeElement.blur();
				var self = input_item;
				weui.picker(column_table.depart_array, {
					onChange: function(result) {
						//						console.log(result);
					},
					onConfirm: function(result) {
						document.getElementById("depart").value = result[0].label;
						document.getElementById("depart").data_id = result[0].value;
					}
				});
			}

			/**
			 * 初始化页码
			 * @param {Object} pages 通过后台拿到的总页数
			 * @param {Object} curr 初始化当前页
			 */
			function initLaypage(pages, curr) {
				laypage({
					cont: 'pages', //容器
					pages: pages, //通过后台拿到的总页数
					curr: curr, //初始化当前页
					jump: function(e, first) { //触发分页后的回调
						//console.log("jump: " + first + " " + JSON.stringify(e));
						if(!first) {
							getexam(e.curr);
						}
					}
				});
			}
		</script>
	</body>

</html>