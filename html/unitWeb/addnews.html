<!--
	作者：刘洋
	时间：2017-07-20
	描述：添加文章
-->
<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>新闻添加</title>
		<link rel="stylesheet" href="../../css/weui.min.css" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			.dropdown:before,
			.dropdown:after {
				content: '';
				position: absolute;
				z-index: 20;
				top: 18px;
				right: 10px;
				border: 4px dashed;
				border-color: #888888 transparent;
			}
			
			.dropdown:before {
				border-bottom-style: solid;
				border-top: none;
			}
			
			.dropdown:after {
				margin-top: 7px;
				border-top-style: solid;
				border-bottom: none;
			}
			
			.dropdown-select:focus {
				z-index: 6;
				width: 100%;
				color: #394349;
				outline: 10px solid #49aff2;
				outline: 2px solid -webkit-focus-ring-color;
				outline-offset: -2px;
			}
			
			.dropdown-select>option {
				margin: 10px;
				padding: 10px 50px;
				text-shadow: none;
				background: #FFFFFF;
				border-radius: 200px;
				cursor: pointer;
			}
			
			.lt-ie9 .dropdown {
				z-index: 1;
			}
			
			.lt-ie9 .dropdown-select {
				z-index: -1;
			}
			
			.lt-ie9 .dropdown-select:focus {
				z-index: 3;
			}
			
			@-moz-document url-prefix() {
				.dropdown-select {
					padding-left: 6px;
				}
			}
			
			.dropdown-dark {
				background: #444;
				border-color: #111111 #0a0a0a black;
				background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.4));
				background-image: -moz-linear-gradient(top, transparent, rgba(0, 0, 0, 0.4));
				background-image: -o-linear-gradient(top, transparent, rgba(0, 0, 0, 0.4));
				background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.4));
				-webkit-box-shadow: inset 0 1px rgba(255, 255, 255, 0.1), 0 1px 1px rgba(0, 0, 0, 0.2);
				box-shadow: inset 0 1px rgba(255, 255, 255, 0.1), 0 1px 1px rgba(0, 0, 0, 0.2);
			}
			
			.dropdown-dark:before {
				border-bottom-color: #aaa;
			}
			
			.dropdown-dark:after {
				border-top-color: #aaa;
			}
			
			.dropdown-dark .dropdown-select {
				color: #aaa;
				text-shadow: 0 1px black;
				background: #444;
				/* Fallback for IE 8 */
			}
			
			.dropdown-dark .dropdown-select:focus {
				color: #ccc;
			}
			
			.dropdown-dark .dropdown-select>option {
				background: #444;
				text-shadow: 0 1px rgba(0, 0, 0, 0.4);
			}
			
			.weui-cells {
				margin-top: 0px;
			}
			
			.weui-cells__title {
				color: black;
			}
		</style>
	</head>

	<body>
		<div class="weui-cells weui-cells_form">
			<div class="weui-cells__title">所属栏目</div>
			<div class="weui-cells">
				<div>
					<section class="container">
						<div class="dropdown">
							<select name="one" id="chnid" class="dropdown-select" style="font-size: 17px;color: #929292;">
								<option value="">请选择所属栏目....</option>
								<option v-for="item in items">{{item.cname}}</option>
							</select>
						</div>
					</section>
				</div>
			</div>
		</div>

		<div id="conetent" class="weui-cells weui-cells_form">
			<div id="input_list">

				<!--输入列表-->
				<div>
					<div class="weui-cells__title">{{cname.title}}</div>
					<div class="weui-cells">
						<div class="weui-cell">
							<div class="weui-cell__bd">
								<input id="cname" v-model.lazy="cname.message" class="weui-input" type="text" :placeholder="'请输入'+cname.title" onchange="upperCase(this.id)">
							</div>
						</div>
					</div>
				</div>

				<div>
					<div class="weui-cells__title">{{fname.title}}</div>
					<div class="weui-cells">
						<div class="weui-cell">
							<div class="weui-cell__bd">
								<input id="fname" v-model.lazy="fname.message" class="weui-input" type="text" :placeholder="'请输入'+fname.title" onchange="upperCase(this.id)">
							</div>
						</div>
					</div>
				</div>

				<div>
					<div class="weui-cells__title">{{newscontent.title}}</div>
					<div class="weui-cells">
						<div class="weui-cell">
							<div class="weui-cell__bd">
								<textarea id="conten" v-model.lazy="newscontent.message" class="weui-input" placeholder="请输入新闻内容" onchange="upperCase(this.id)" style="border-color: white;height: 10rem;"></textarea>
							</div>
						</div>
					</div>
				</div>

				<!--<div id="image_list">
					<todo-item></todo-item>
				</div>-->

			<div id="onisfileup">
					<div class="weui-cells__title">文件上传</div>
					    <div class="weui-cells">
					    	<div class="weui-cell">
					    		<div class="weui-cell__bd">
                                     <input id="blogrollimagename" type="file"style=" height: 30px;" onchange="setBlogrollImageName(this)"   name="fileUpload" />
                                </div>
                             </div>
                        </div>    
                        
				</div>

				<div>
					<div class="weui-cells__title">{{newszy.title}}</div>
					<div class="weui-cells">
						<div class="weui-cell">
							<div class="weui-cell__bd">
								<input id="summas" v-model.lazy="newszy.message" class="weui-input" type="text" :placeholder="'请输入'+newszy.title">
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--开关列表-->
			<div id="switch_list">
				<div>
					<div class="weui-cell weui-cell_switch">
						<div class="weui-cell__bd">{{islink.title}}</div>
						<div class="weui-cell__ft">
							<input id="islink" class="weui-switch" type="checkbox" v-model="islink.check">
						</div>
					</div>
				</div>
				<div v-if="islink.check">
					<div class="weui-cells">
						<div class="weui-cell">
							<div class="weui-cell__bd">
								<input id="quourl" v-model.lazy="linkurl.message" class="weui-input" type="text" :placeholder="'请输入'+linkurl.title">
							</div>
						</div>
					</div>
				</div>
				<div id="onisReply">
					<div class="weui-cell weui-cell_switch">
						<div class="weui-cell__bd">{{isReply.title}}</div>
						<div class="weui-cell__ft">
							<input id="isReply" class="weui-switch" type="checkbox" v-model="isReply.check">
						</div>
					</div>
				</div>

			</div>
			<div class="weui-btn-area">
				<button id="submit" v-on:click="submitClick" class="weui-btn weui-btn_primary">{{editName}}</button>
			</div>
		</div>
		<!--<script src="../../js/mui.min.js"></script>-->
		<script type="text/javascript" src="../../js/weui.min.js"></script>
		<script type="text/javascript" src="../../js/vue.min.js"></script>
		<script type="text/javascript" src="../../js/jweixin.js"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript">
			document.write("<s" + "cript type='text/javascript' src='../../js/importJS.js?" + Math.random() + "'></s" + "cript>");
		</script>
		<script type="text/javascript">
//			//图片组件
//			Vue.component('todo-item', {
//				template: '<div class="weui-cells__title">文件上传</div><div class="weui-cells"><div class="weui-cell"><div class="weui-cell__bd"><input type="file"style=" height: 30px;" name="fileUpload" /></div></div></div>',
//			})

           function setBlogrollImageName(basicfile){
document.getElementById("blogrollimagename").value=basicfile.value;
}


			//所属栏目下拉框
			var vue_input = new Vue({
				el: '#chnid',
				data: {
					items: []
				}
			});
			window.onload = function() {

				/**
				 * 获取网站配置信息
				 */
				var webConfig;
				var tempData = {
					cmd: 'webcfg',
					type: 'find'
				}
				unitWebsitePro(tempData, function(data) {
					console.log('配置为:' + JSON.stringify(data));
					if(data.RspCode == 0) {
						if(data.RspData.length > 0) {
							webConfig = data.RspData[0];
							if(webConfig.isreply == 0) //0表示禁止回复，并隐藏回复功能
								document.getElementById('onisReply').style.display = "none";
							if(webConfig.isfileup == 0) //0表示禁止上传，并隐藏回复功能
								document.getElementById('onisfileup').style.display = "none";
						} else {
							weui.alert('没有获取到配置信息')
						}
					} else {
						weui.alert(data.RspTxt);
					}
				});
				/**
				 * 获取网站栏目
				 */
				var tempData = {
					cmd: 'chn', //网站栏目
					type: 'findpage', //分页查找栏目列表
					pagesize: 999, //每页条数
					pageindex: 1 //页码
				}
				unitWebsitePro(tempData, function(data) {
					alert(JSON.stringify(data.RspData.dt));
					if(data.RspCode == 0) {
						if(data.RspData.dt.length > 0) {
							vue_input.items = data.RspData.dt;
						} else {
							alert('暂时还没有栏目');
						}
					} else {
						alert(data.RspTxt);
					}
				});

				var detail = utils.getDataFromUrl(window.location.href);
				vm.type = 'edit1';
				if(vm.type == 'edit') {
					vm.editName = '删除';
					vm.chnid = detail.chnid;
					vm.cname.message = detail.cname;
					vm.orderid.message = detail.orderid;
					vm.linkurl.message = detail.linkurl;
					vm.islink.check = detail.islink;
					vm.iswrite.check = detail.iswrite;
					for(var item in vm.$data) {
						(function addwatch(key) {
							vm.$watch(key + '.message', function(newVal, oldVal) {
								edit(oldVal, newVal, key)
							})
						})(item)
					}
				} else {
					vm.editName = '添加'
				}
			}

			var vm = new Vue({
				el: '#conetent',
				data: {
					editName: '',
					cname: {
						title: "新闻标题",
						message: ""
					},
					fname: {
						title: "新闻副标题",
						message: ""
					},
					newscontent: {
						title: "新闻内容",
						message: ""
					},
					newszy: {
						title: "新闻摘要",
						message: ""
					},
					linkurl: {
						title: "引用地址",
						message: ""
					},
					islink: {
						title: "是否为引用",
						check: true
					},
					isReply: {
						title: "是否允许回复",
						check: true
					},

				},
				computed: {
					// a computed getter
					write: function() {
						return !this.islink.check
					}
				},
				methods: {
					submitClick: function() {}
				}
			})

			//按钮监听
			document.getElementById('submit').addEventListener('tap', function() {
				var PriIsquo = '';
				var PriQuourl = '';
				var comData = '';
				var PriIsReply = '';
				var PriTopic = document.getElementById("cname").value; //新闻标题
				var Prisubtopic = document.getElementById("fname").value; //新闻副标题
				var PriConten = document.getElementById("conten").value; //新闻内容
				var PriSummas = document.getElementById("summas").value; //新闻摘要
				var Chnid = document.getElementById("chnid"); //栏目id
				var PriChnid = Chnid.selectedIndex; // 选中索引
				console.log('所属栏目=========================:' + PriChnid);
				PriIsquo = document.getElementById("islink").checked == true ? 1 : 0;
				PriIsReply = document.getElementById("isReply").checked == true ? 1 : 0; 
					PriQuourl = document.getElementById("quourl").value;
					comData = {
						cmd: 'news', //文章管理
						type: 'add',
						chnid: PriChnid,
						subtopic: Prisubtopic,
						topic: PriTopic,
						content: PriConten,
						summas: PriSummas,
						isquo: PriIsquo,
						quourl: PriQuourl,
						isreply: PriIsReply,
						stat: webConfig.isnewchk
					}; 
				unitWebsitePro(comData, function(data) {
					if(data.RspCode == 0) {
						weui.toast("添加成功");
						//清空数据 
						document.getElementById("cname").value = ""; //新闻标题
						document.getElementById("conten").value = ""; //新闻内容
						document.getElementById("summas").value = ""; //新闻摘要
						document.getElementById("chnid").selectedIndex = 0; //栏目id
						document.getElementById("quourl").value = ""; //引用地址
						document.getElementById("fname").value = "";

					} else {
						weui.toast(data.RspTxt);
					}
				});
				console.log('comData=========================:' + JSON.stringify(comData));
			});
			//编辑发送协议
			function upperCase(x) {
				if(vm.type == 'edit') {
					switch(x) {
						case 'cname': //新闻标题
							var y = document.getElementById(x).value;
							console.log(y);
							var data = {
								type: 0,
								index: 0,
								callcol: "skinid",
								colv: x
							}
							changeWebsiteConfig(data)
							break;
						case 'conten': //新闻内容
							var y = document.getElementById(x).value;
							console.log(y);
							var data = {
								type: 0,
								index: 0,
								callcol: "skinid",
								colv: x
							}
							changeWebsiteConfig(data)
							break;
						default:
							break;
					}
					document.getElementById(x).value = y.toUpperCase()
				}
			}

			/**
			 * 修改网站设置
			 * @param {Object} change 修改的数据
			 * @param {String} type 类型，0输入;1开关;2皮肤id
			 * @param {String} index 第几个数据
			 */
			function changeWebsiteConfig(change) {
				var commit = {
					cmd: 'webcfg',
					type: 'edit'
				}
				unitWebsitePro(commit, function(data) {
					alert("1");
					if(data.RspCode == 0) { //成功
						weui.toast("操作成功");
					} else {
						weui.alert("修改失败:" + data.RspTxt);
					}
				});
				if(1) { //成功
					weui.toast("操作成功");
					if(change.type == 2) {
						vm_skin.skinId = commit.colv;
					}
				} else {
					if(change.type == 1) { //开关
						vm_switch.switchArray[change.index].check = !change.colv;
					}
					weui.alert("修改失败");
				}
				//---假数据---end---
			}
		</script>
	</body>

</html>